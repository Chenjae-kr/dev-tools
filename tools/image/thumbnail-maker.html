<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog Thumbnail Maker | Dev Tools</title>
<script src="../../tools.js"></script>
<script src="../../nav.js"></script>
<script src="../../ui-utils.js"></script>
<script src="../../image-tools-utils.js"></script>
<link rel="stylesheet" href="../../styles.css">
<style>
.canvas-wrap{display:flex;justify-content:center;align-items:center;padding:14px;background:var(--surface2);border-radius:10px;border:1px solid var(--border)}
#thumbCanvas{max-width:100%;height:auto;border-radius:8px;background:#fff}
.input-area{width:100%;background:transparent;border:1px solid var(--border);outline:none;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.6;padding:10px 12px;resize:vertical;min-height:66px;border-radius:8px}
#padHint{font-size:10px;color:var(--text-dim)}
.main-grid > .output-panel{position:sticky;top:84px;align-self:start}
.main-grid > .output-panel .panel{max-height:calc(100vh - 110px);overflow:auto}
@media (max-width: 980px){.main-grid > .output-panel{position:static}.main-grid > .output-panel .panel{max-height:none;overflow:visible}}
</style>
</head>
<body>
<script>renderNav();</script>
<div class="container">
  <div class="tool-header">
    <h1>Blog <span>Thumbnail Maker</span></h1>
    <p>// 비율 선택 + 배경(단색/이미지) + 텍스트로 썸네일 생성</p>
  </div>

  <div class="main-grid">
    <div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title"><div class="dot"></div>SETTINGS</div></div>

        <div class="setting-group">
          <div class="setting-title">Canvas & Background</div>
          <div class="options-bar">
            <span class="options-label">Ratio</span>
            <div class="toggle-group">
              <button class="toggle-btn ratio-btn active" data-ratio="1:1">1:1</button>
              <button class="toggle-btn ratio-btn" data-ratio="16:9">16:9</button>
              <button class="toggle-btn ratio-btn" data-ratio="4:3">4:3</button>
              <button class="toggle-btn ratio-btn" data-ratio="3:2">3:2</button>
            </div>
            <span class="options-label">Preset</span>
            <div class="toggle-group">
              <button class="toggle-btn preset-btn active" data-preset="quote">Quote</button>
              <button class="toggle-btn preset-btn" data-preset="blog">Blog</button>
              <button class="toggle-btn preset-btn" data-preset="youtube">YouTube</button>
            </div>
          </div>
          <div class="options-bar">
            <span class="options-label">Background</span>
            <div class="toggle-group">
              <button class="toggle-btn bgmode-btn active" data-bgmode="color">단색</button>
              <button class="toggle-btn bgmode-btn" data-bgmode="image">이미지</button>
            </div>
            <div id="bgColorBar"><input id="bgColor" type="color" value="#5f6fdd" class="table-name-input input-xs color-input"></div>
            <div id="bgImageBar" class="hidden"><input id="bgImageInput" type="file" accept="image/*"></div>
          </div>
          <div class="options-bar">
            <span class="options-label">Overlay</span>
            <div class="toggle-group">
              <button class="toggle-btn ov-btn active" data-ov="none">None</button>
              <button class="toggle-btn ov-btn" data-ov="dim">Dim</button>
              <button class="toggle-btn ov-btn" data-ov="gradient">Gradient</button>
              <button class="toggle-btn ov-btn" data-ov="vignette">Vignette</button>
            </div>
            <span class="options-label">Strength</span>
            <input id="ovStrength" type="number" value="28" min="0" max="100" class="table-name-input input-xs">
          </div>
          <div class="options-bar">
            <span class="options-label">Decor</span>
            <div class="toggle-group">
              <button class="toggle-btn decor-btn active" data-decor="quote-frame">Style 1</button>
              <button class="toggle-btn decor-btn" data-decor="double-frame">Style 2</button>
              <button class="toggle-btn decor-btn" data-decor="corner-lines">Style 3</button>
              <button class="toggle-btn decor-btn" data-decor="clean-box">Style 4</button>
              <button class="toggle-btn decor-btn" data-decor="minimal">Style 5</button>
            </div>
          </div>
        </div>

        <div class="setting-group">
          <div class="setting-title">Text Content</div>
          <div class="options-bar"><span class="options-label">Main</span></div>
          <textarea id="mainText" class="input-area" placeholder="메인 텍스트">블로그 썸네일
3분 제작</textarea>
          <div class="options-bar"><span class="options-label">Sub</span></div>
          <textarea id="subText" class="input-area" placeholder="서브 텍스트">3분만에 블로그 썸네일 만들기</textarea>

          <div class="options-bar row-tight">
            <span class="options-label">JSON Data</span>
            <button class="toggle-btn" onclick="fillThumbJsonFromInputs()">현재값 채우기</button>
            <button class="toggle-btn" onclick="applyThumbJsonToInputs()">JSON 적용</button>
            <button class="toggle-btn" onclick="document.getElementById('thumbJsonFile').click()">JSON 파일</button>
            <input id="thumbJsonFile" type="file" accept=".json,application/json" class="hidden">
          </div>
          <textarea id="thumbJsonInput" class="input-area" placeholder='{
  "mainText": "블로그 썸네일\n3분 제작",
  "subText": "3분만에 블로그 썸네일 만들기",
  "ratio": "1:1",
  "bgColor": "#5f6fdd"
}'></textarea>
          <div id="thumbJsonHint" class="text-muted mt-8">JSON으로 텍스트/스타일/배경 옵션을 한번에 반영할 수 있어요.</div>
        </div>

        <div class="setting-group">
          <div class="setting-title">Text Style & Position</div>
          <div class="options-bar">
            <span class="options-label">Text Color</span>
            <input id="textColor" type="color" value="#ffffff" class="table-name-input input-xs color-input">
            <span class="options-label">Stroke</span>
            <input id="strokeColor" type="color" value="#000000" class="table-name-input input-xs color-input">
            <span class="options-label">Stroke Px</span>
            <input id="strokeWidth" type="number" value="6" min="0" max="24" class="table-name-input input-xs">
          </div>
          <div class="options-bar">
            <span class="options-label">Text Area Padding</span>
            <input id="pad" type="number" value="90" min="20" max="220" class="table-name-input input-xs">
            <span class="options-label" id="padHint">값이 클수록 텍스트 폭이 좁아집니다</span>
          </div>
          <div class="options-bar">
            <span class="options-label">Main Size%</span>
            <input id="mainScale" type="number" value="100" min="50" max="180" class="table-name-input input-xs">
            <span class="options-label">Main Y%</span>
            <input id="mainY" type="number" value="43" min="10" max="85" class="table-name-input input-xs">
            <span class="options-label">Sub Size%</span>
            <input id="subScale" type="number" value="100" min="50" max="180" class="table-name-input input-xs">
            <span class="options-label">Sub Y%</span>
            <input id="subY" type="number" value="72" min="10" max="95" class="table-name-input input-xs">
          </div>
        </div>

        <div class="setting-group">
          <div class="setting-title">Export</div>
          <div class="options-row options-row-2">
            <div class="options-item">
              <div class="options-bar row-tight">
                <span class="options-label">Save As</span>
                <div class="toggle-group">
                  <button class="toggle-btn fmt-btn active" data-fmt="png">PNG</button>
                  <button class="toggle-btn fmt-btn" data-fmt="jpeg">JPG</button>
                  <button class="toggle-btn fmt-btn" data-fmt="webp">WEBP</button>
                </div>
              </div>
            </div>
            <div class="options-item">
              <div class="options-bar row-tight">
                <span class="options-label">Quality</span>
                <input id="imgQuality" type="number" value="92" min="1" max="100" class="table-name-input input-sm">
              </div>
            </div>
          </div>
          <div class="download-actions">
            <button class="export-btn all download-btn all full" onclick="downloadThumb()">⬇ 다운로드</button>
          </div>
        </div>
      </div>
    </div>

    <div class="output-panel" id="outputPanel">
      <div class="panel">
        <div class="canvas-wrap">
          <canvas id="thumbCanvas" width="1200" height="1200"></canvas>
        </div>
      </div>
    </div>
  </div>
  <footer>// Thumbnail Maker</footer>
</div>

<script>
let ratio = '1:1';
let bgMode = 'color';
let bgImage = null;
let overlayMode = 'none';
let decorStyle = 'quote-frame';
let saveFormat = 'png';

const ratios = { '1:1':[1200,1200], '16:9':[1600,900], '4:3':[1200,900], '3:2':[1500,1000] };
const presets = {
  quote: {
    ratio: '1:1', bgColor: '#5f6fdd', textColor: '#ffffff', strokeColor: '#000000', strokeWidth: 6, pad: 90, ov: 'none', ovStrength: 28, decor: 'quote-frame',
    mainScale: 100, subScale: 100, mainY: 43, subY: 72,
    main: '블로그 썸네일\n3분 제작', sub: '3분만에 블로그 썸네일 만들기'
  },
  blog: {
    ratio: '4:3', bgColor: '#2e3f8f', textColor: '#ffffff', strokeColor: '#000000', strokeWidth: 5, pad: 80, ov: 'gradient', ovStrength: 32, decor: 'double-frame',
    mainScale: 100, subScale: 95, mainY: 41, subY: 73,
    main: '실전 가이드\n핵심 요약', sub: '바로 적용 가능한 블로그 포스트 템플릿'
  },
  youtube: {
    ratio: '16:9', bgColor: '#1c1f2a', textColor: '#ffffff', strokeColor: '#000000', strokeWidth: 6, pad: 70, ov: 'vignette', ovStrength: 40, decor: 'corner-lines',
    mainScale: 110, subScale: 95, mainY: 42, subY: 74,
    main: '조회수 올리는\n썸네일', sub: '클릭을 부르는 타이틀 디자인'
  }
};

document.querySelectorAll('.ratio-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.ratio-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active'); ratio=b.dataset.ratio; renderThumb();
});
document.querySelectorAll('.bgmode-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.bgmode-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active'); bgMode=b.dataset.bgmode;
  document.getElementById('bgColorBar').classList.toggle('hidden', bgMode!=='color');
  document.getElementById('bgImageBar').classList.toggle('hidden', bgMode!=='image');
  renderThumb();
});

document.querySelectorAll('.ov-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.ov-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  overlayMode = b.dataset.ov;
  renderThumb();
});

document.querySelectorAll('.preset-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.preset-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyPreset(b.dataset.preset);
});

document.querySelectorAll('.decor-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.decor-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  decorStyle = b.dataset.decor;
  renderThumb();
});

document.querySelectorAll('.fmt-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.fmt-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  saveFormat = b.dataset.fmt;
});

document.getElementById('bgImageInput').addEventListener('change', e=>{
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{ const img=new Image(); img.onload=()=>{ bgImage=img; renderThumb(); }; img.src=ev.target.result; };
  r.readAsDataURL(f);
});

document.getElementById('thumbJsonFile').addEventListener('change', e=>{
  const f=e.target.files?.[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{
    try {
      const txt = String(ev.target?.result || '');
      document.getElementById('thumbJsonInput').value = txt;
      applyThumbJsonToInputs();
    } catch (_) {
      document.getElementById('thumbJsonHint').textContent = 'JSON 파일을 읽는 중 오류가 발생했습니다.';
    }
  };
  r.readAsText(f, 'utf-8');
});

['bgColor','textColor','strokeColor','strokeWidth','mainText','subText','pad','ovStrength','mainScale','subScale','mainY','subY'].forEach(id=>{
  document.getElementById(id).addEventListener('input', ()=>renderThumb());
});

function applyPreset(name){
  const p = presets[name];
  if(!p) return;

  ratio = p.ratio;
  document.querySelectorAll('.ratio-btn').forEach(x=>x.classList.toggle('active', x.dataset.ratio===ratio));

  overlayMode = p.ov;
  document.querySelectorAll('.ov-btn').forEach(x=>x.classList.toggle('active', x.dataset.ov===overlayMode));

  decorStyle = p.decor || 'quote-frame';
  document.querySelectorAll('.decor-btn').forEach(x=>x.classList.toggle('active', x.dataset.decor===decorStyle));

  document.getElementById('bgColor').value = p.bgColor;
  document.getElementById('textColor').value = p.textColor;
  document.getElementById('strokeColor').value = p.strokeColor || '#000000';
  if (p.strokeWidth != null) document.getElementById('strokeWidth').value = p.strokeWidth;
  document.getElementById('pad').value = p.pad;
  document.getElementById('ovStrength').value = p.ovStrength;
  document.getElementById('mainText').value = p.main;
  document.getElementById('subText').value = p.sub;
  if (p.mainScale) document.getElementById('mainScale').value = p.mainScale;
  if (p.subScale) document.getElementById('subScale').value = p.subScale;
  if (p.mainY) document.getElementById('mainY').value = p.mainY;
  if (p.subY) document.getElementById('subY').value = p.subY;
  fillThumbJsonFromInputs(false);
  renderThumb();
}

function setToggleByData(selector, key, value){
  document.querySelectorAll(selector).forEach(btn=>btn.classList.toggle('active', btn.dataset[key]===value));
}

function fillThumbJsonFromInputs(showMsg=true){
  const payload = {
    mainText: document.getElementById('mainText').value || '',
    subText: document.getElementById('subText').value || '',
    ratio,
    bgMode,
    bgColor: document.getElementById('bgColor').value || '#5f6fdd',
    overlay: overlayMode,
    overlayStrength: parseInt(document.getElementById('ovStrength').value || '28', 10),
    decor: decorStyle,
    textColor: document.getElementById('textColor').value || '#ffffff',
    strokeColor: document.getElementById('strokeColor').value || '#000000',
    strokeWidth: parseInt(document.getElementById('strokeWidth').value || '6', 10),
    padding: parseInt(document.getElementById('pad').value || '90', 10),
    mainScale: parseInt(document.getElementById('mainScale').value || '100', 10),
    subScale: parseInt(document.getElementById('subScale').value || '100', 10),
    mainY: parseInt(document.getElementById('mainY').value || '43', 10),
    subY: parseInt(document.getElementById('subY').value || '72', 10),
    saveFormat,
    quality: parseInt(document.getElementById('imgQuality').value || '92', 10)
  };
  document.getElementById('thumbJsonInput').value = JSON.stringify(payload, null, 2);
  if (showMsg) document.getElementById('thumbJsonHint').textContent = '현재 설정을 JSON으로 채웠습니다.';
}

function applyThumbJsonObject(rawObj){
  const obj = (rawObj && typeof rawObj === 'object' && rawObj.thumbnail && typeof rawObj.thumbnail === 'object')
    ? rawObj.thumbnail
    : rawObj;
  if (!obj || typeof obj !== 'object') throw new Error('object expected');

  if (obj.mainText != null) document.getElementById('mainText').value = String(obj.mainText);
  if (obj.subText != null) document.getElementById('subText').value = String(obj.subText);

  if (obj.ratio && ratios[obj.ratio]) {
    ratio = obj.ratio;
    setToggleByData('.ratio-btn','ratio',ratio);
  }
  if (obj.bgMode === 'color' || obj.bgMode === 'image') {
    bgMode = obj.bgMode;
    setToggleByData('.bgmode-btn','bgmode',bgMode);
    document.getElementById('bgColorBar').classList.toggle('hidden', bgMode!=='color');
    document.getElementById('bgImageBar').classList.toggle('hidden', bgMode!=='image');
  }
  if (obj.bgColor) document.getElementById('bgColor').value = String(obj.bgColor);

  const ov = obj.overlay ?? obj.ov;
  if (ov && ['none','dim','gradient','vignette'].includes(String(ov))) {
    overlayMode = String(ov);
    setToggleByData('.ov-btn','ov',overlayMode);
  }
  if (obj.overlayStrength != null || obj.ovStrength != null) {
    document.getElementById('ovStrength').value = parseInt(obj.overlayStrength ?? obj.ovStrength, 10);
  }

  if (obj.decor) {
    decorStyle = String(obj.decor);
    setToggleByData('.decor-btn','decor',decorStyle);
  }

  if (obj.textColor) document.getElementById('textColor').value = String(obj.textColor);
  if (obj.strokeColor) document.getElementById('strokeColor').value = String(obj.strokeColor);
  if (obj.strokeWidth != null) document.getElementById('strokeWidth').value = parseInt(obj.strokeWidth, 10);
  if (obj.padding != null || obj.pad != null) document.getElementById('pad').value = parseInt(obj.padding ?? obj.pad, 10);
  if (obj.mainScale != null) document.getElementById('mainScale').value = parseInt(obj.mainScale, 10);
  if (obj.subScale != null) document.getElementById('subScale').value = parseInt(obj.subScale, 10);
  if (obj.mainY != null) document.getElementById('mainY').value = parseInt(obj.mainY, 10);
  if (obj.subY != null) document.getElementById('subY').value = parseInt(obj.subY, 10);

  const fmt = obj.saveFormat ?? obj.format;
  if (fmt && ['png','jpeg','webp'].includes(String(fmt))) {
    saveFormat = String(fmt);
    setToggleByData('.fmt-btn','fmt',saveFormat);
  }
  if (obj.quality != null || obj.imgQuality != null) {
    document.getElementById('imgQuality').value = parseInt(obj.quality ?? obj.imgQuality, 10);
  }
}

function applyThumbJsonToInputs(){
  const raw = (document.getElementById('thumbJsonInput').value || '').trim();
  if (!raw) {
    document.getElementById('thumbJsonHint').textContent = 'JSON 입력값이 비어 있습니다.';
    return;
  }
  try {
    const obj = JSON.parse(raw);
    applyThumbJsonObject(obj);
    fillThumbJsonFromInputs(false);
    renderThumb();
    document.getElementById('thumbJsonHint').textContent = 'JSON 적용 완료';
  } catch (_) {
    document.getElementById('thumbJsonHint').textContent = 'JSON 형식이 올바르지 않습니다. 예시를 확인해 주세요.';
  }
}

function drawBg(ctx,w,h){
  if(bgMode==='image' && bgImage){
    ImageToolUtils.drawImageCover(ctx, bgImage, 0, 0, w, h);
  } else {
    ctx.fillStyle = document.getElementById('bgColor').value;
    ctx.fillRect(0,0,w,h);
  }
}

function drawOverlay(ctx,w,h){
  const strength = Math.max(0, Math.min(100, parseInt(document.getElementById('ovStrength').value || '28', 10))) / 100;
  if(overlayMode==='none' || strength <= 0) return;

  if(overlayMode==='dim'){
    ctx.fillStyle = `rgba(0,0,0,${(0.65*strength).toFixed(3)})`;
    ctx.fillRect(0,0,w,h);
    return;
  }

  if(overlayMode==='gradient'){
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0, `rgba(0,0,0,${(0.2*strength).toFixed(3)})`);
    g.addColorStop(0.55, `rgba(0,0,0,${(0.55*strength).toFixed(3)})`);
    g.addColorStop(1, `rgba(0,0,0,${(0.8*strength).toFixed(3)})`);
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);
    return;
  }

  if(overlayMode==='vignette'){
    const rg = ctx.createRadialGradient(w/2,h/2,Math.min(w,h)*0.25,w/2,h/2,Math.max(w,h)*0.75);
    rg.addColorStop(0, `rgba(0,0,0,0)`);
    rg.addColorStop(1, `rgba(0,0,0,${(0.8*strength).toFixed(3)})`);
    ctx.fillStyle = rg;
    ctx.fillRect(0,0,w,h);
  }
}

const fitFont = (ctx,text,maxW,start) => ImageToolUtils.fitTextSize(ctx, text, maxW, start, 18, 700);

function drawOutlinedText(ctx, text, x, y, fillColor, strokeColor, outlinePx) {
  const o = Math.max(0, Math.round(outlinePx));
  ctx.shadowColor = 'transparent';
  ctx.shadowBlur = 0;
  ctx.shadowOffsetX = 0;
  ctx.shadowOffsetY = 0;

  if (o > 0) {
    ctx.fillStyle = strokeColor;
    for (let dy = -o; dy <= o; dy++) {
      for (let dx = -o; dx <= o; dx++) {
        if (dx === 0 && dy === 0) continue;
        if (dx*dx + dy*dy <= o*o) ctx.fillText(text, x + dx, y + dy);
      }
    }
  }

  ctx.fillStyle = fillColor;
  ctx.fillText(text, x, y);
}

function drawDecor(ctx, w, h) {
  const m=Math.max(34,Math.floor(w*0.08));
  const lw=Math.max(6,Math.floor(w*0.007));
  ctx.strokeStyle='rgba(255,255,255,0.92)';
  ctx.fillStyle='rgba(255,255,255,0.95)';
  ctx.lineWidth=lw;

  if (decorStyle === 'minimal') return;

  if (decorStyle === 'quote-frame') {
    ctx.strokeRect(m,m,w-m*2,h-m*2);
    ctx.font = `700 ${Math.floor(w*0.12)}px serif`;
    ctx.fillText('“', m-38, m+130);
    ctx.fillText('”', w-m-28, h-m+72);
    return;
  }

  if (decorStyle === 'double-frame') {
    ctx.strokeRect(m,m,w-m*2,h-m*2);
    ctx.globalAlpha=0.7;
    ctx.strokeRect(m+Math.floor(lw*2.2),m+Math.floor(lw*2.2),w-m*2-Math.floor(lw*4.4),h-m*2-Math.floor(lw*4.4));
    ctx.globalAlpha=1;
    return;
  }

  if (decorStyle === 'corner-lines') {
    const l=Math.floor(Math.min(w,h)*0.14);
    const r=w-m, b=h-m;
    ctx.beginPath();
    // TL
    ctx.moveTo(m,m+l); ctx.lineTo(m,m); ctx.lineTo(m+l,m);
    // TR
    ctx.moveTo(r-l,m); ctx.lineTo(r,m); ctx.lineTo(r,m+l);
    // BL
    ctx.moveTo(m,b-l); ctx.lineTo(m,b); ctx.lineTo(m+l,b);
    // BR
    ctx.moveTo(r-l,b); ctx.lineTo(r,b); ctx.lineTo(r,b-l);
    ctx.stroke();
    return;
  }

  if (decorStyle === 'clean-box') {
    ctx.globalAlpha=0.8;
    ctx.fillRect(m,m,w-m*2,h-m*2);
    ctx.globalAlpha=1;
    ctx.strokeStyle='rgba(255,255,255,0.65)';
    ctx.strokeRect(m,m,w-m*2,h-m*2);
    return;
  }
}

function renderThumb(){
  const [w,h]=ratios[ratio];
  const pad=parseInt(document.getElementById('pad').value||'90',10);
  const main=(document.getElementById('mainText').value||'').trim();
  const sub=(document.getElementById('subText').value||'').trim();
  const color=document.getElementById('textColor').value;
  const strokeColor=document.getElementById('strokeColor').value;
  const strokeBase = Math.max(0, Math.min(24, parseInt(document.getElementById('strokeWidth').value || '6', 10)));
  const mainScale = Math.max(50, Math.min(180, parseInt(document.getElementById('mainScale').value || '100', 10))) / 100;
  const subScale = Math.max(50, Math.min(180, parseInt(document.getElementById('subScale').value || '100', 10))) / 100;
  const mainYPct = Math.max(10, Math.min(85, parseInt(document.getElementById('mainY').value || '43', 10))) / 100;
  const subYPct = Math.max(10, Math.min(95, parseInt(document.getElementById('subY').value || '72', 10))) / 100;

  const cv=document.getElementById('thumbCanvas');
  cv.width=w; cv.height=h;
  const ctx=cv.getContext('2d');

  drawBg(ctx,w,h);
  drawOverlay(ctx,w,h);

  // decor
  drawDecor(ctx,w,h);

  // text
  ctx.fillStyle=color;
  const maxW=w-pad*2;
  const mainLines=main.split('\n').filter(Boolean);
  let y=h*mainYPct;
  mainLines.forEach((line)=>{
    const fs=fitFont(ctx,line,maxW,Math.floor(w*0.105*mainScale));
    ctx.font = `800 ${fs}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`;
    ctx.textAlign='center';
    drawOutlinedText(ctx, line, w/2, y, color, strokeColor, strokeBase > 0 ? strokeBase : 0);
    y += fs*1.12;
  });

  const subFs = fitFont(ctx, sub.replace(/\n/g,' '), maxW, Math.floor(w*0.05*subScale));
  ctx.font = `700 ${subFs}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`;
  ctx.textAlign='center';
  drawOutlinedText(ctx, sub, w/2, h*subYPct, 'rgba(255,255,255,0.96)', strokeColor, strokeBase > 0 ? Math.max(1, Math.round(strokeBase*0.7)) : 0);
}

function downloadThumb(){
  renderThumb();
  const q = Math.max(1, Math.min(100, parseInt(document.getElementById('imgQuality').value || '92', 10))) / 100;
  ImageToolUtils.downloadCanvas(document.getElementById('thumbCanvas'), {
    format: saveFormat,
    quality: q,
    filename: `thumbnail_${ratio.replace(':','x')}_${Date.now()}`
  });
}

applyPreset('quote');
fillThumbJsonFromInputs(false);
</script>
</body>
</html>