<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Masker | Dev Tools</title>
<script src="../../tools.js"></script>
<script src="../../nav.js"></script>
<script src="../../ui-utils.js"></script>
<link rel="stylesheet" href="../../styles.css">
<style>
.txt{width:100%;min-height:240px;background:transparent;border:none;outline:none;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.7;padding:14px 20px;resize:vertical}
</style>
</head>
<body>
<script>renderNav();</script>
<div class="container">
  <div class="tool-header"><h1>Data <span>Masker</span></h1><p>// í…ìŠ¤íŠ¸/JSON ë‚´ ê°œì¸ì •ë³´ íŒ¨í„´ ë§ˆìŠ¤í‚¹</p></div>

  <div class="main-grid">
    <div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title"><div class="dot"></div>INPUT</div><button class="sample-btn" onclick="loadSample()">ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button></div>

        <div class="setting-group" data-level="basic">
          <div class="setting-title">Source</div>
          <textarea id="input" class="txt" placeholder="name: í™ê¸¸ë™
email: test@example.com
phone: 010-1234-5678
card: 1234-5678-1234-5678"></textarea>
        </div>

        <div class="setting-group" data-level="basic">
          <div class="setting-title">Options</div>
          <div class="options-bar"><span class="options-label">Patterns</span><div class="toggle-group"><button class="toggle-btn p active" data-p="name">Name</button><button class="toggle-btn p active" data-p="email">Email</button><button class="toggle-btn p active" data-p="phone">Phone</button><button class="toggle-btn p active" data-p="card">Card</button><button class="toggle-btn p active" data-p="rrn">RRN</button></div></div>
        </div>

        <button class="generate-btn" onclick="maskNow()" data-shortcut="Ctrl + Enter">âš¡ ë§ˆìŠ¤í‚¹</button>
      </div>
    </div>

    <div class="output-panel" id="out">
      <div class="panel"><div class="empty-state"><div class="icon">ğŸ›¡ï¸</div><p>ì…ë ¥ í›„ ë§ˆìŠ¤í‚¹ì„ ì‹¤í–‰í•˜ì„¸ìš”.</p></div></div>
    </div>
  </div>

  <footer>// Data Masker</footer>
</div>

<script>
const esc=UIUtils.escHtml;
const enabled={name:true,email:true,phone:true,card:true,rrn:true};
document.querySelectorAll('.p').forEach(b=>b.onclick=()=>{const k=b.dataset.p;enabled[k]=!enabled[k];b.classList.toggle('active',enabled[k])});

function maskNow(){
  const t=document.getElementById('input').value;
  if(!t.trim()) return UIUtils.showError('out','ì…ë ¥ í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
  let o=t;
  if(enabled.name) {
    o=o.replace(/\b(name|username|user_name|fullname|full_name|ì´ë¦„|ì„±ëª…)\s*[:=]\s*([^\n\r,]+)/gi,(m,k,v)=>{
      const s=String(v||'').trim();
      if(!s) return m;
      const vis=s.length<=2 ? 1 : 2;
      return `${k}: ${s.slice(0,vis)}${'*'.repeat(Math.max(1,s.length-vis))}`;
    });
  }
  if(enabled.email) o=o.replace(/\b([A-Z0-9._%+-]{1,64})@([A-Z0-9.-]+\.[A-Z]{2,})\b/gi,(m,u,d)=>u.slice(0,2)+'***@'+d);
  if(enabled.phone) o=o.replace(/\b(?:\+?82[-\s]?)?0?1[016789][-\s]?\d{3,4}[-\s]?\d{4}\b/g,m=>m.replace(/\d(?=(?:\D*\d){4})/g,'*'));
  if(enabled.card)  o=o.replace(/\b(?:\d{4}[-\s]?){3}\d{4}\b/g,m=>m.replace(/\d(?=(?:\D*\d){4})/g,'*'));
  if(enabled.rrn)   o=o.replace(/\b\d{6}[-\s]?[1-4]\d{6}\b/g,m=>m.slice(0,8)+'******');

  const id='mask_'+Date.now();
  document.getElementById('out').innerHTML=UIUtils.renderSqlBlock({
    badge:'MASK',
    tag:'PII Redacted',
    copyBtnId:`copy_${id}`,
    copyLabel:'COPY',
    copyHandler:`copyOut('${id}')`,
    wrapBtnId:id,
    bodyHtml:`<pre class="sql-code" id="${id}">${esc(o)}</pre>`
  });
  scrollToOutput(document.getElementById('out'));
}

function copyOut(id){UIUtils.copyElementText(id,`copy_${id}`,'COPY')}
function loadSample(){document.getElementById('input').value=`name: í™ê¸¸ë™
email: hong@example.com
phone: 010-1234-5678
card: 1234-5678-1234-5678
rrn: 900101-1234567`;}
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='Enter')maskNow();});
</script>
</body>
</html>