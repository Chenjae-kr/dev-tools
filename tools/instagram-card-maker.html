<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instagram Card News Maker | Dev Tools</title>
<script src="../tools.js"></script>
<script src="../nav.js"></script>
<script src="../ui-utils.js"></script>
<link rel="stylesheet" href="../styles.css">
<style>
.canvas-wrap{display:flex;justify-content:center;align-items:center;padding:14px;background:var(--surface2);border-radius:10px;border:1px solid var(--border)}
#cardCanvas{max-width:100%;height:auto;border-radius:8px;background:#fff}
.input-area{width:100%;background:transparent;border:none;outline:none;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.6;padding:10px 12px;resize:vertical;min-height:72px}
.small{max-width:90px}
.hidden{display:none}
</style>
</head>
<body>
<script>renderNav();</script>
<div class="container">
  <div class="tool-header">
    <h1>Instagram <span>Card News Maker</span></h1>
    <p>// ì œëª©/ì†Œì œëª© + ë³¸ë¬¸(í…ìŠ¤íŠ¸Â·í‘œÂ·ì´ë¯¸ì§€) ì¹´ë“œë‰´ìŠ¤ ì œì‘</p>
  </div>

  <div class="main-grid">
    <div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title"><div class="dot"></div>SETTINGS</div></div>

        <div class="options-bar">
          <span class="options-label">Size</span>
          <div class="toggle-group">
            <button class="toggle-btn size-btn active" data-size="1:1">1:1</button>
            <button class="toggle-btn size-btn" data-size="4:5">4:5</button>
            <button class="toggle-btn size-btn" data-size="9:16">9:16</button>
          </div>
          <span class="options-label">Theme</span>
          <div class="toggle-group">
            <button class="toggle-btn theme-btn active" data-theme="navy">Navy</button>
            <button class="toggle-btn theme-btn" data-theme="blue">Blue</button>
            <button class="toggle-btn theme-btn" data-theme="green">Green</button>
          </div>
        </div>

        <div class="options-bar" style="border-top:none;padding-top:0;">
          <span class="options-label">Background</span>
          <div class="toggle-group">
            <button class="toggle-btn bgmode-btn active" data-bgmode="color">ë‹¨ìƒ‰</button>
            <button class="toggle-btn bgmode-btn" data-bgmode="image">ì´ë¯¸ì§€</button>
          </div>
          <input id="bgColor" type="color" value="#0b122b" class="table-name-input small" style="padding:4px 6px;">
          <input id="bgImageInput" type="file" accept="image/*" style="display:none">
        </div>

        <div class="options-bar" style="border-top:none;padding-top:0;"><span class="options-label">Headline Line 1</span></div>
        <textarea id="titleText" class="input-area" placeholder="ì¹´ë“œë‰´ìŠ¤ ì œëª© 1ì¤„"></textarea>

        <div class="options-bar" style="border-top:none;padding-top:0;"><span class="options-label">Headline Line 2</span></div>
        <textarea id="titleText2" class="input-area" placeholder="ì¹´ë“œë‰´ìŠ¤ ì œëª© 2ì¤„"></textarea>

        <div class="options-bar" style="border-top:none;padding-top:0;">
          <span class="options-label">Headline Color</span>
          <span class="options-label">L1</span><input id="titleColor1" type="color" value="#111111" class="table-name-input small" style="padding:4px 6px;">
          <span class="options-label">L2</span><input id="titleColor2" type="color" value="#d41414" class="table-name-input small" style="padding:4px 6px;">
        </div>

        <div class="options-bar" style="border-top:none;padding-top:0;"><span class="options-label">Subtitle</span></div>
        <textarea id="subTitleText" class="input-area" placeholder="ì†Œì œëª©/ìš”ì•½"></textarea>

        <div class="options-bar" style="border-top:none;padding-top:0;">
          <span class="options-label">Label Banner</span>
          <input id="labelText" class="table-name-input" placeholder="2026ë…„ IPO ì˜ˆìƒ ì£¼ìš” ê¸°ì—…" value="2026ë…„ IPO ì˜ˆìƒ ì£¼ìš” ê¸°ì—…">
        </div>

        <div class="options-bar" style="border-top:none;padding-top:0;">
          <span class="options-label">Body Type</span>
          <div class="toggle-group">
            <button class="toggle-btn bodytype-btn active" data-body="text">Text</button>
            <button class="toggle-btn bodytype-btn" data-body="table">Table</button>
            <button class="toggle-btn bodytype-btn" data-body="image">Image</button>
          </div>
        </div>

        <div id="bodyTextWrap">
          <div class="options-bar" style="border-top:none;padding-top:0;"><span class="options-label">Body Text</span></div>
          <textarea id="bodyText" class="input-area" placeholder="ë³¸ë¬¸ í…ìŠ¤íŠ¸ (ì¤„ë°”ê¿ˆ ì§€ì›)"></textarea>
        </div>

        <div id="bodyTableWrap" class="hidden">
          <div class="options-bar" style="border-top:none;padding-top:0;"><span class="options-label">Table Data (CSV)</span></div>
          <textarea id="tableText" class="input-area" placeholder="ê¸°ì—…ëª…,ì˜ˆìƒê°€ì¹˜,ì£¼ìš”ì‚¬ì—…\nì¼€ì´ë±…í¬,3ì¡° 3,673ì–µ,ì¸í„°ë„·ì „ë¬¸ì€í–‰"></textarea>
        </div>

        <div id="bodyImageWrap" class="hidden">
          <div class="options-bar" style="border-top:none;padding-top:0;"><span class="options-label">Body Image</span>
            <input id="bodyImageInput" type="file" accept="image/*"></div>
        </div>

        <div class="options-bar" style="border-top:none;padding-top:0;">
          <span class="options-label">Footer Source</span>
          <input id="sourceText" class="table-name-input" value="ì¶œì²˜: ê´€ë ¨ ìë£Œ" placeholder="ì¶œì²˜: ...">
        </div>
        <div class="options-bar" style="border-top:none;padding-top:0;">
          <span class="options-label">Watermark</span>
          <input id="brandText" class="table-name-input" value="@flow.itself" placeholder="@your_brand">
        </div>

        <div class="options-bar" style="border-top:none;padding-top:0;">
          <span class="options-label">Pages</span>
          <input id="pageCount" type="number" value="1" min="1" max="20" class="table-name-input small">
          <button class="toggle-btn" onclick="prevPage()">â—€</button>
          <span id="pageLabel" class="options-label">1 / 1</span>
          <button class="toggle-btn" onclick="nextPage()">â–¶</button>
        </div>

        <div class="options-bar" style="border-top:none;padding-top:0;">
          <button class="generate-btn" onclick="renderCard()">âš¡ RENDER</button>
          <button class="generate-btn" onclick="savePage()">ğŸ’¾ í˜ì´ì§€ ì €ì¥</button>
          <button class="generate-btn" onclick="downloadCurrent()">â¬‡ í˜„ì¬ PNG</button>
          <button class="generate-btn" onclick="downloadAll()">â¬‡ ì „ì²´ PNG</button>
        </div>
      </div>
    </div>

    <div class="output-panel">
      <div class="panel">
        <div class="canvas-wrap"><canvas id="cardCanvas" width="1080" height="1080"></canvas></div>
      </div>
    </div>
  </div>
  <footer>// Instagram Card News Maker</footer>
</div>

<script>
const sizes = { '1:1':[1080,1080], '4:5':[1080,1350], '9:16':[1080,1920] };
const themes = {
  navy:{bg:'#0b122b',box:'#ffffff',accent:'#d41414',text:'#0b122b',sub:'#1a2b5f'},
  blue:{bg:'#102c6d',box:'#ffffff',accent:'#0a52cc',text:'#111',sub:'#1f376e'},
  green:{bg:'#0f2f24',box:'#ffffff',accent:'#0a7a4f',text:'#111',sub:'#24443a'}
};
let sizeKey='1:1', themeKey='navy', bgMode='color', bgImage=null;
let page=1, pages=[{}], bodyType='text';

function newPage(){ return {title:'',title2:'',subtitle:'',label:'',source:'ì¶œì²˜: ê´€ë ¨ ìë£Œ',brand:'@flow.itself',bodyType:'text',bodyText:'',tableText:'',bodyImageData:''}; }
function getCanvas(){return document.getElementById('cardCanvas');}
function current(){return pages[page-1] || newPage();}
function setPageLabel(){document.getElementById('pageLabel').textContent=`${page} / ${pages.length}`;document.getElementById('pageCount').value=pages.length;}

function setBodyUI(){
  document.getElementById('bodyTextWrap').classList.toggle('hidden', bodyType!=='text');
  document.getElementById('bodyTableWrap').classList.toggle('hidden', bodyType!=='table');
  document.getElementById('bodyImageWrap').classList.toggle('hidden', bodyType!=='image');
}

function fillInputsFromPage(){
  const p=current();
  document.getElementById('titleText').value=p.title||'';
  document.getElementById('titleText2').value=p.title2||'';
  document.getElementById('subTitleText').value=p.subtitle||'';
  document.getElementById('labelText').value=p.label||'';
  document.getElementById('bodyText').value=p.bodyText||'';
  document.getElementById('tableText').value=p.tableText||'';
  document.getElementById('sourceText').value=p.source||'ì¶œì²˜: ê´€ë ¨ ìë£Œ';
  document.getElementById('brandText').value=p.brand||'@flow.itself';
  bodyType=p.bodyType||'text';
  document.querySelectorAll('.bodytype-btn').forEach(b=>b.classList.toggle('active', b.dataset.body===bodyType));
  setBodyUI();
}

function savePage(){
  pages[page-1]={
    ...(pages[page-1]||newPage()),
    title:document.getElementById('titleText').value,
    title2:document.getElementById('titleText2').value,
    subtitle:document.getElementById('subTitleText').value,
    label:document.getElementById('labelText').value,
    bodyType,
    source:document.getElementById('sourceText').value,
    brand:document.getElementById('brandText').value,
    bodyText:document.getElementById('bodyText').value,
    tableText:document.getElementById('tableText').value,
  };
}

function syncPages(){
  const n=Math.max(1,Math.min(20,parseInt(document.getElementById('pageCount').value||'1',10)));
  while(pages.length<n) pages.push(newPage());
  while(pages.length>n) pages.pop();
  if(page>pages.length) page=pages.length;
  setPageLabel();
}

function prevPage(){savePage();if(page>1) page--;fillInputsFromPage();setPageLabel();renderCard();}
function nextPage(){savePage();if(page<pages.length) page++;fillInputsFromPage();setPageLabel();renderCard();}

function fit(ctx,text,maxW,start){ let s=start; while(s>18){ ctx.font=`800 ${s}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`; if(ctx.measureText(text).width<=maxW) return s; s-=2;} return s; }

function parseCsvTable(text){
  const lines=(text||'').split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  if(lines.length<2) return null;
  const rows=lines.map(l=>l.split(',').map(c=>c.trim()));
  return {head:rows[0], body:rows.slice(1)};
}

function drawCoverImage(ctx,w,h,img){
  const ir=img.width/img.height, cr=w/h; let dw=w,dh=h,dx=0,dy=0;
  if(ir>cr){dh=h;dw=h*ir;dx=(w-dw)/2;} else {dw=w;dh=w/ir;dy=(h-dh)/2;}
  ctx.drawImage(img,dx,dy,dw,dh);
}

function drawBg(ctx,w,h){
  const th=themes[themeKey];
  if(bgMode==='image' && bgImage){
    drawCoverImage(ctx,w,h,bgImage);
    ctx.fillStyle='rgba(0,0,0,0.28)'; ctx.fillRect(0,0,w,h);
  } else {
    ctx.fillStyle=document.getElementById('bgColor').value||th.bg; ctx.fillRect(0,0,w,h);
  }
}

function renderCard(){
  savePage();
  const cv=getCanvas(); const [w,h]=sizes[sizeKey]; cv.width=w; cv.height=h; const ctx=cv.getContext('2d');
  const th=themes[themeKey]; const p=current();

  drawBg(ctx,w,h);

  // white board panel
  const margin=Math.floor(w*0.04); const panelX=margin, panelY=Math.floor(h*0.06), panelW=w-margin*2, panelH=h-panelY-Math.floor(h*0.06);
  ctx.fillStyle=th.box; ctx.fillRect(panelX,panelY,panelW,panelH);
  ctx.strokeStyle='rgba(0,0,0,0.16)'; ctx.lineWidth=2; ctx.strokeRect(panelX,panelY,panelW,panelH);

  // title lines + subtitle + label banner
  const t1=(p.title||'').trim();
  const t2=(p.title2||'').trim();
  const subLines=(p.subtitle||'').split('\n').filter(Boolean);
  const titleColor1=document.getElementById('titleColor1').value;
  const titleColor2=document.getElementById('titleColor2').value;

  let y=panelY+Math.floor(panelH*0.08);
  if (t1) {
    const fs1=fit(ctx,t1,panelW-60,Math.floor(h*0.055));
    ctx.font=`900 ${fs1}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`;
    ctx.fillStyle=titleColor1;
    ctx.textAlign='center';
    ctx.fillText(t1,panelX+panelW/2,y);
    y += Math.floor(fs1*1.08);
  }
  if (t2) {
    const fs2=fit(ctx,t2,panelW-60,Math.floor(h*0.06));
    ctx.font=`900 ${fs2}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`;
    ctx.fillStyle=titleColor2;
    ctx.fillText(t2,panelX+panelW/2,y);
    y += Math.floor(fs2*1.1);
  }

  subLines.slice(0,2).forEach(line=>{
    const fs=fit(ctx,line,panelW-100,Math.floor(h*0.03));
    ctx.font=`700 ${fs}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`;
    ctx.fillStyle=th.sub;
    ctx.fillText(line,panelX+panelW/2,y);
    y += Math.floor(fs*1.2);
  });

  const label=(p.label||'').trim();
  if (label) {
    const lw=Math.min(panelW*0.72, Math.max(panelW*0.34, ctx.measureText(label).width + 40));
    const lh=Math.floor(h*0.05);
    const lx=panelX + (panelW-lw)/2;
    const ly=y;
    ctx.fillStyle='#ffffff';
    ctx.fillRect(lx,ly,lw,lh);
    ctx.strokeStyle='rgba(0,0,0,0.35)';
    ctx.setLineDash([6,4]);
    ctx.strokeRect(lx,ly,lw,lh);
    ctx.setLineDash([]);
    ctx.fillStyle='#222';
    ctx.font=`700 ${Math.floor(lh*0.44)}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`;
    ctx.textAlign='center';
    ctx.fillText(label, lx+lw/2, ly+Math.floor(lh*0.67));
    y += lh + Math.floor(h*0.016);
  } else {
    y += Math.floor(h*0.02);
  }
  const contentX=panelX+24, contentY=y, contentW=panelW-48, contentH=panelY+panelH-y-28;

  // body by type
  if(p.bodyType==='text'){
    ctx.fillStyle='rgba(16,38,90,0.07)'; ctx.fillRect(contentX,contentY,contentW,contentH);
    const lines=(p.bodyText||'').split('\n').filter(Boolean);
    let ty=contentY+36;
    lines.forEach(line=>{
      const fs=fit(ctx,line,contentW-30,Math.floor(h*0.03));
      ctx.font=`700 ${fs}px Pretendard, Apple SD Gothic Neo, Malgun Gothic, sans-serif`;
      ctx.fillStyle='#1b1f2a';
      ctx.textAlign='left';
      ctx.fillText(line,contentX+14,ty);
      ty += Math.floor(fs*1.45);
    });
  } else if(p.bodyType==='table'){
    const t=parseCsvTable(p.tableText||'');
    if(!t){
      ctx.fillStyle='#777'; ctx.font=`600 ${Math.floor(h*0.024)}px sans-serif`; ctx.fillText('í‘œ ë°ì´í„°(CSV)ë¥¼ ì…ë ¥í•˜ì„¸ìš”', contentX+8, contentY+40);
    } else {
      const cols=t.head.length; const rows=Math.min(t.body.length,10);
      const rh=Math.floor(contentH/(rows+1)); const cw=Math.floor(contentW/cols);
      // header
      for(let c=0;c<cols;c++){
        ctx.fillStyle='#0f2f7d'; ctx.fillRect(contentX+c*cw,contentY,cw,rh);
        ctx.fillStyle='#fff'; ctx.font=`700 ${Math.floor(rh*0.34)}px sans-serif`; ctx.textAlign='center';
        ctx.fillText((t.head[c]||'').slice(0,14), contentX+c*cw+cw/2, contentY+Math.floor(rh*0.62));
      }
      // rows
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const y0=contentY+rh*(r+1), x0=contentX+c*cw;
          ctx.fillStyle=(r%2===0)?'#f6f8ff':'#ffffff'; ctx.fillRect(x0,y0,cw,rh);
          ctx.strokeStyle='rgba(0,0,0,0.2)'; ctx.strokeRect(x0,y0,cw,rh);
          ctx.fillStyle='#111'; ctx.font=`600 ${Math.floor(rh*0.33)}px sans-serif`; ctx.textAlign='center';
          const v=((t.body[r]&&t.body[r][c])||'').slice(0,16);
          ctx.fillText(v, x0+cw/2, y0+Math.floor(rh*0.6));
        }
      }
    }
  } else if(p.bodyType==='image'){
    if(p.bodyImageData){
      const img=new Image();
      img.onload=()=>{ drawCoverImage(ctx,contentW,contentH,img); };
      // draw framed image immediately on separate temp
      const tmp=new Image();
      tmp.onload=()=>{
        const ir=tmp.width/tmp.height, cr=contentW/contentH; let dw=contentW,dh=contentH,dx=contentX,dy=contentY;
        if(ir>cr){dh=contentH;dw=contentH*ir;dx=contentX+(contentW-dw)/2;} else {dw=contentW;dh=contentW/ir;dy=contentY+(contentH-dh)/2;}
        ctx.drawImage(tmp,dx,dy,dw,dh);
        ctx.strokeStyle='rgba(0,0,0,0.3)'; ctx.strokeRect(contentX,contentY,contentW,contentH);
      };
      tmp.src=p.bodyImageData;
    } else {
      ctx.fillStyle='rgba(0,0,0,0.06)'; ctx.fillRect(contentX,contentY,contentW,contentH);
      ctx.fillStyle='#666'; ctx.font=`600 ${Math.floor(h*0.024)}px sans-serif`; ctx.textAlign='center';
      ctx.fillText('ë³¸ë¬¸ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”',contentX+contentW/2,contentY+contentH/2);
    }
  }

  // footer
  const source = (p.source || 'ì¶œì²˜: ê´€ë ¨ ìë£Œ').trim();
  const brand = (p.brand || '@flow.itself').trim();
  const fh = 34;
  ctx.fillStyle='rgba(5,10,25,0.9)'; ctx.fillRect(panelX,panelY+panelH-fh,panelW,fh);
  ctx.fillStyle='#fff'; ctx.textAlign='left'; ctx.font='600 16px Pretendard, sans-serif'; ctx.fillText(source, panelX+12,panelY+panelH-11);
  ctx.textAlign='right'; ctx.font='700 18px JetBrains Mono, sans-serif'; ctx.fillText(`${brand}  ${page}/${pages.length}`, panelX+panelW-12,panelY+panelH-11);
}

function downloadCurrent(){ savePage(); renderCard(); const a=document.createElement('a'); a.href=getCanvas().toDataURL('image/png'); a.download=`card_${page}_${sizeKey.replace(':','x')}.png`; a.click(); }
async function downloadAll(){ savePage(); const cur=page; for(let i=1;i<=pages.length;i++){ page=i; fillInputsFromPage(); renderCard(); const a=document.createElement('a'); a.href=getCanvas().toDataURL('image/png'); a.download=`card_${i}_${sizeKey.replace(':','x')}.png`; a.click(); await new Promise(r=>setTimeout(r,120)); } page=cur; fillInputsFromPage(); renderCard(); setPageLabel(); }

// UI bindings
document.querySelectorAll('.size-btn').forEach(b=>b.onclick=()=>{document.querySelectorAll('.size-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');sizeKey=b.dataset.size;renderCard();});
document.querySelectorAll('.theme-btn').forEach(b=>b.onclick=()=>{document.querySelectorAll('.theme-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');themeKey=b.dataset.theme;document.getElementById('bgColor').value=themes[themeKey].bg;renderCard();});
document.querySelectorAll('.bgmode-btn').forEach(b=>b.onclick=()=>{document.querySelectorAll('.bgmode-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');bgMode=b.dataset.bgmode;document.getElementById('bgImageInput').style.display=bgMode==='image'?'':'none';renderCard();});
document.querySelectorAll('.bodytype-btn').forEach(b=>b.onclick=()=>{document.querySelectorAll('.bodytype-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');bodyType=b.dataset.body;setBodyUI();savePage();renderCard();});

['bgColor','titleText','titleText2','titleColor1','titleColor2','subTitleText','labelText','sourceText','brandText','bodyText','tableText','pageCount'].forEach(id=>document.getElementById(id).addEventListener('input',()=>{if(id==='pageCount')syncPages();renderCard();}));

document.getElementById('bgImageInput').addEventListener('change',e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{const i=new Image();i.onload=()=>{bgImage=i;renderCard();};i.src=ev.target.result;};r.readAsDataURL(f);});
document.getElementById('bodyImageInput').addEventListener('change',e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{pages[page-1].bodyImageData=ev.target.result;renderCard();};r.readAsDataURL(f);});

// init
pages[0]={
  title:'ğŸ“ˆ ìƒˆí•´ ì½”ìŠ¤í”¼ëŠ” ë‚´ê°€ ì´ëˆë‹¤!',
  title2:'ì¼€ì´ë±…í¬ ìƒì¥, ê³µëª¨ê°€ í™•ì •',
  subtitle:'ì‹ ê·œ ìƒì¥ ì‹œì¥ ì „ë§ 2026',
  label:'2026ë…„ IPO ì˜ˆìƒ ì£¼ìš” ê¸°ì—…',
  source:'ì¶œì²˜: ê´€ë ¨ ì–¸ë¡ ë³´ë„',
  brand:'@flow.itself',
  bodyType:'table',
  bodyText:'',
  tableText:'ê¸°ì—…ëª…,ì˜ˆìƒê¸°ì—…ê°€ì¹˜,ì£¼ìš” ì‚¬ì—…\në¬´ì‹ ì‚¬,8ì¡°ì› ì´ìƒ,íŒ¨ì…˜ í”Œë«í¼\ní•œí™”ì—ë„ˆì§€,5ì¡°ì› ì´ìƒ,ì—ë„ˆì§€ ë°œì „Â·ê³µê¸‰\nì¼€ì´ë±…í¬,3ì¡° 3,673ì–µ,ì¸í„°ë„·ì „ë¬¸ì€í–‰',
  bodyImageData:''
};
fillInputsFromPage(); setBodyUI(); setPageLabel(); renderCard();
</script>
</body>
</html>