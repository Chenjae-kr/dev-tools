<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JSON Dummy Generator | Dev Tools</title>
<script src="../../tools.js"></script>
<script src="../../nav.js"></script>
<script src="../../ui-utils.js"></script>
<link rel="stylesheet" href="../../styles.css">
<style>
.txt{width:100%;min-height:260px;background:transparent;border:1px solid var(--border);outline:none;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.7;padding:12px;border-radius:8px;resize:vertical}
</style>
</head>
<body>
<script>renderNav();</script>

<div class="container">
  <div class="tool-header">
    <h1>JSON <span>Dummy Generator</span></h1>
    <p>// JSON í…œí”Œë¦¿(íƒ€ì… íŒíŠ¸) ê¸°ë°˜ ë”ë¯¸ ë°ì´í„° ë°°ì—´ ìƒì„±</p>
  </div>

  <div class="main-grid">
    <div>
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title"><div class="dot"></div>INPUT</div>
          <button class="sample-btn" onclick="loadSample()">ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>

        <div class="setting-group" data-level="basic">
          <div class="setting-title">Template JSON</div>
          <textarea id="templateInput" class="txt" placeholder='{
  "id": "int(1,9999)",
  "name": "name",
  "email": "email",
  "phone": "phone",
  "active": "boolean",
  "score": "float(0,100,2)",
  "createdAt": "datetime",
  "profile": {
    "city": "city",
    "bio": "lorem(12)"
  }
}'></textarea>
        </div>

        <div class="setting-group" data-level="basic">
          <div class="setting-title">Options</div>
          <div class="options-row options-row-2">
            <div class="options-item">
              <div class="options-bar row-tight">
                <span class="options-label">Rows</span>
                <input id="rowCount" type="number" min="1" max="10000" value="20" class="table-name-input input-sm">
              </div>
            </div>
            <div class="options-item">
              <div class="options-bar row-tight">
                <span class="options-label">Seed</span>
                <input id="seed" type="number" value="42" class="table-name-input input-sm">
              </div>
            </div>
          </div>
          <div class="options-row options-row-2">
            <div class="options-item">
              <div class="options-bar row-tight">
                <span class="options-label">Output</span>
                <div class="toggle-group">
                  <button class="toggle-btn out-btn active" data-out="pretty">Pretty</button>
                  <button class="toggle-btn out-btn" data-out="minify">Minify</button>
                </div>
              </div>
            </div>
            <div class="options-item">
              <div class="options-bar row-tight">
                <span class="options-label">Root</span>
                <div class="toggle-group">
                  <button class="toggle-btn root-btn active" data-root="array">Array</button>
                  <button class="toggle-btn root-btn" data-root="ndjson">NDJSON</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button class="generate-btn" data-shortcut="Ctrl + Enter" onclick="generateDummy()">âš¡ ìƒì„±</button>
      </div>
    </div>

    <div class="output-panel" id="outputPanel">
      <div class="panel">
        <div class="empty-state">
          <div class="icon">ğŸ§ª</div>
          <p>í…œí”Œë¦¿ JSON ì…ë ¥ í›„ ìƒì„± ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</p>
        </div>
      </div>
    </div>
  </div>

  <footer>// Template JSON â†’ Dummy Data Array</footer>
</div>

<script>
let outMode = 'pretty';
let rootMode = 'array';

document.querySelectorAll('.out-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.out-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  outMode = b.dataset.out;
});

document.querySelectorAll('.root-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.root-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  rootMode = b.dataset.root;
});

function makeRng(seed){
  let s = (Number(seed) || 42) >>> 0;
  return function(){
    s = (1664525 * s + 1013904223) >>> 0;
    return s / 4294967296;
  };
}

function randInt(rng, min, max){ return Math.floor(rng() * (max - min + 1)) + min; }
function randFloat(rng, min, max, d=2){ return Number((rng() * (max - min) + min).toFixed(d)); }
function pick(rng, arr){ return arr[Math.floor(rng() * arr.length)] || ''; }

const firstNames = ['ë¯¼ì¤€','ì„œì¤€','ë„ìœ¤','ì˜ˆì¤€','ì§€ìš°','í•˜ì¤€','ì£¼ì›','ì§€í›„','ì§€ì•ˆ','íƒœìœ¤'];
const lastNames  = ['ê¹€','ì´','ë°•','ìµœ','ì •','ê°•','ì¡°','ìœ¤','ì¥','ì„'];
const cities = ['ì„œìš¸','ë¶€ì‚°','ëŒ€êµ¬','ì¸ì²œ','ê´‘ì£¼','ëŒ€ì „','ìš¸ì‚°','ìˆ˜ì›','ê³ ì–‘','ì„±ë‚¨'];
const domains = ['example.com','mail.com','devtools.ai','test.kr','demo.io'];
const words = ['ë°ì´í„°','ë¶„ì„','ìë™í™”','ìƒì„±','ê²€ì¦','ìƒ˜í”Œ','í…ŒìŠ¤íŠ¸','ë„êµ¬','í¬ë§·','ë³€í™˜','í’ˆì§ˆ','ëœë¤'];

function randName(rng){ return pick(rng,lastNames) + pick(rng,firstNames); }
function randEmail(rng){ return `user${randInt(rng,1000,99999)}@${pick(rng,domains)}`; }
function randPhone(rng){ return `010-${randInt(rng,1000,9999)}-${randInt(rng,1000,9999)}`; }
function randDate(rng){
  const d = new Date(Date.now() - randInt(rng,0, 3600*24*365*3) * 1000);
  return d.toISOString().slice(0,10);
}
function randDatetime(rng){
  const d = new Date(Date.now() - randInt(rng,0, 3600*24*365*3) * 1000);
  return d.toISOString();
}
function randUuid(rng){
  const h = '0123456789abcdef';
  const seg = n => Array.from({length:n},()=>h[Math.floor(rng()*16)]).join('');
  return `${seg(8)}-${seg(4)}-4${seg(3)}-${pick(rng,['8','9','a','b'])}${seg(3)}-${seg(12)}`;
}
function randLorem(rng, n=10){
  return Array.from({length:n},()=>pick(rng,words)).join(' ');
}

function parseToken(token){
  const t = String(token || '').trim();
  const mInt = t.match(/^int\((-?\d+),\s*(-?\d+)\)$/i);
  if (mInt) return { kind:'int', min:parseInt(mInt[1],10), max:parseInt(mInt[2],10) };
  const mFloat = t.match(/^float\((-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)(?:,\s*(\d+))?\)$/i);
  if (mFloat) return { kind:'float', min:parseFloat(mFloat[1]), max:parseFloat(mFloat[2]), d:parseInt(mFloat[3] || '2',10) };
  const mLorem = t.match(/^lorem\((\d+)\)$/i);
  if (mLorem) return { kind:'lorem', n:parseInt(mLorem[1],10) };
  return { kind:t.toLowerCase() };
}

function genFromSchema(schema, rng){
  if (Array.isArray(schema)) {
    if (!schema.length) return [];
    const len = randInt(rng, 1, 3);
    return Array.from({length:len}, ()=>genFromSchema(schema[0], rng));
  }

  if (schema && typeof schema === 'object') {
    const out = {};
    Object.entries(schema).forEach(([k,v]) => { out[k] = genFromSchema(v, rng); });
    return out;
  }

  if (typeof schema !== 'string') return schema;

  const token = parseToken(schema);
  if (token.kind === 'int') return randInt(rng, token.min, token.max);
  if (token.kind === 'float') return randFloat(rng, token.min, token.max, token.d);
  if (token.kind === 'lorem') return randLorem(rng, token.n);

  if (token.kind === 'name') return randName(rng);
  if (token.kind === 'email') return randEmail(rng);
  if (token.kind === 'phone') return randPhone(rng);
  if (token.kind === 'city') return pick(rng, cities);
  if (token.kind === 'date') return randDate(rng);
  if (token.kind === 'datetime') return randDatetime(rng);
  if (token.kind === 'uuid') return randUuid(rng);
  if (token.kind === 'boolean' || token.kind === 'bool') return rng() > 0.5;
  if (token.kind === 'number') return randInt(rng, 0, 10000);

  return schema;
}

function generateDummy(){
  const output = document.getElementById('outputPanel');
  const raw = (document.getElementById('templateInput').value || '').trim();
  if (!raw) return UIUtils.showError('outputPanel', 'í…œí”Œë¦¿ JSONì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');

  const rows = Math.max(1, Math.min(10000, parseInt(document.getElementById('rowCount').value || '20', 10)));
  const seed = parseInt(document.getElementById('seed').value || '42', 10);

  try {
    const schema = JSON.parse(raw);
    const rng = makeRng(seed);
    const arr = Array.from({length:rows}, ()=>genFromSchema(schema, rng));

    const text = rootMode === 'ndjson'
      ? arr.map(v=>JSON.stringify(v)).join('\n')
      : (outMode === 'pretty' ? JSON.stringify(arr, null, 2) : JSON.stringify(arr));

    const id = `dummy_${Date.now()}`;
    output.innerHTML = UIUtils.renderSqlBlock({
      badge: 'JSON',
      tag: `Rows ${rows}`,
      copyBtnId: `copy_${id}`,
      copyLabel: 'COPY',
      copyHandler: `copyDummy('${id}')`,
      wrapBtnId: id,
      bodyHtml: `<pre class="sql-code" id="${id}">${UIUtils.escHtml(text)}</pre>`
    }) + `<div class="download-actions mt-10"><button class="download-btn all full" onclick="downloadDummy('${id}', 'dummy_${rows}.${rootMode==='ndjson'?'ndjson':'json'}')">â¬‡ ë‹¤ìš´ë¡œë“œ</button></div>`;

    scrollToOutput(output);
  } catch (e) {
    UIUtils.showError('outputPanel', `JSON íŒŒì‹± ì‹¤íŒ¨: ${e?.message || e}`);
  }
}

function copyDummy(id){ UIUtils.copyElementText(id, `copy_${id}`, 'COPY'); }
function downloadDummy(id, filename){ UIUtils.downloadTextFile(document.getElementById(id).textContent || '', filename, 'application/json;charset=utf-8'); }

function loadSample(){
  document.getElementById('templateInput').value = `{
  "id": "int(1,9999)",
  "name": "name",
  "email": "email",
  "phone": "phone",
  "active": "boolean",
  "score": "float(0,100,2)",
  "createdAt": "datetime",
  "profile": {
    "city": "city",
    "bio": "lorem(12)"
  }
}`;
  document.getElementById('rowCount').value = 20;
  document.getElementById('seed').value = 42;
}

document.addEventListener('keydown', (e)=>{
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') generateDummy();
});
</script>
</body>
</html>